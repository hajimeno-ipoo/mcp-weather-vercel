---
description: 事実に基づいた調査、原因特定、修正計画、実装のプロセスのためのワークフロー
---

# 事実に基づいた調査と確実な実装ワークフロー (Factual Investigation Workflow)

このワークフローは、不確実な推測を排除し、観測された事実に基いて問題を解決するための手順を定義します。特に、OpenAIウィジェット環境のような制限のある環境でのデバッグにおいて、高い再現性と確実性を保証します。

## ステップ

### 1. 事実調査 (Factual Investigation)
- **環境の特性確認**: ホスト環境の制約（HTMLサニタイズ、セキュリティポリシー、CSS制限など）を調査します。
- **直接観測**: `browser_subagent` や `chrome-devtools` を使用し、実際のDOMの状態やスタイル、コンソールログ、ネットワークリクエストを直接確認します。
- **再現環境の構築**: `debug.html` などのスタンドアロンな再現ファイルを作成します。これにより、外部要因を切り分けて純粋な技術的動作を検証します。

### 2. 原因特定 (Root Cause Identification)
- **観測結果の分析**: 調査で得られた「事実（Observed Facts）」に基づき、問題の真因を特定します。
- **失敗の振り返り**: もし過去に失敗した修正がある場合、なぜその手法が機能しなかったのかを事実（例：スタイルがサニタイズで消えていた等）に基づいて説明します。

### 3. ディフプランの作成 (Planning)
- **根本解決策の設計**: 特定された原因を解消するための具体的な修正案を作成します。
- **成功パターンの適用**: 動作が既に確認されている「実績のある手法」（例：ウィジェットでの `document.createElement` 使用など）を選択します。
- **リスク評価**: 修正による副作用や制限事項を検討し、計画に含めます。

### 4. 実装と最終検証 (Implementation & Verification)
- **コード修正**: 計画に従い、`multi_replace_file_content` 等を使用してコードを修正します。
- **事実による検証**: 修正後、再び `browser_subagent` 等を用いて、問題が事実として解決されたことを直接確認します。
- **マルチモード確認**: ライト/ダークモード、異なる入力データなど、複数のケースで整合性を確認します。

## 注意事項
- 「おそらく〜だろう」という推測（Guesswork）を避け、「〜という事実を観測した」という事実（Evidence）を優先してください。
- ウィジェット環境では、CSSクラスや `innerHTML` 内のインラインスタイルがサニタイズされる可能性があるため、常に `createElement` ＋ `style.cssText` のパターンを推奨します。
