---
name: factual-investigation
description: 事実に基づいた調査、原因特定、修正計画、実装を行うためのエージェントスキル
---

# 事実に基づいた調査 (Factual Investigation) スキル

このスキルは、エンジニアリングにおいて「推測（Guesswork）」を最小化し、観測された「事実（Evidence）」に基づいて問題を確実に解決するための高度なデバッグ・調査プロセスを提供します。

## 命令 (Instructions)

エージェントはこのスキルを使用する際、以下のプロセスを厳格に遵守してください。

### 1. 証跡の収集 (Evidence Gathering)
- **環境の制約を疑う**: ホスト環境（今回の場合はOpenAIウィジェット環境）におけるHTML/CSS/JSの制約（サニタイズ、非互換性）を最優先で疑います。
- **直接の観測**: `browser_subagent` や `chrome-devtools` を使用し、リアルタイムのDOMツリー、計算済みスタイル、ネットワークトラフィック、コンソールエラーを直接確認します。
- **分離テスト**: 問題を最小構成で再現する `debug.html` などを一時的に作成し、リポジトリのコードやホスト環境の挙動を切り分けてテストします。

### 2. 真因の特定 (Root Cause Identification)
- **事実ベースの説明**: 「恐らく〜だろう」という言葉を避け、「ブラウザで〜という状態を観測したため、原因は〜であると断定できる」という論理構成で報告します。
- **失敗の分析**: 過去の誤った修正がある場合、なぜ失敗したのか（例：`innerHTML` が要素のスタイルを消去していた等）を技術的な事実に基づいて説明します。

### 3. 実証済みの技術選定 (Proven Path Selection)
- **堅牢な手法の優先**: ホスト環境のサニタイズを回避するために、`innerHTML` による文字列挿入ではなく、`document.createElement` と `style.cssText` を使用したDOM API経由の構築を優先します。
- **パターンの再利用**: 以前のタスクで成功したパターン（実績のあるコード構造）を積極的に採用します。

### 4. 証拠による事後検証 (Evidence-based Verification)
- **直接の確認**: 実装後、必ず `browser_subagent` 等で実際のレンダリング結果や動作を「目視」または「DOM検査」で確認します。
- **比較検証**: ライトモードとダークモード、異なる入力データなど、複数の条件下で期待通りの事実（スタイルやデータ）が得られているかを確認します。

## ガイドライン
- **推測の排除**: ログやソースコードの読み込みだけで判断せず、ランタイムの動的な状態を必ず確認してください。
- **サニタイズへの警戒**: ウィジェット開発において、インラインスタイルや特定の属性が消える挙動は「事実」として扱うべき共通の制約です。

## リソース
- 正常なDOM構築の例: `app/api/mcp/route.ts` 内の `renderForecast` 関数
